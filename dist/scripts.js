"use strict";var app={queue:[],chars:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],auth_endpoint:"https://stamkracht.api.dasboard.co/api-token-auth/",refresh_endpoint:"https://stamkracht.api.dasboard.co/api-token-refresh/",ws_endpoint:"wss://beanstalk-pubsub.sk-test.com/ws/commits?subscribe-broadcast",commit_font_size:20,commit_animation_duration:15,init:function(){app.renewToken(),app.setBackgroundColor(),app.setClickListeners(),app.setTouchListeners()},fetchToken:function(e){var t=new XMLHttpRequest;t.open("POST",app.auth_endpoint,!0),t.setRequestHeader("Content-type","application/json;charset=UTF-8"),t.onload=function(){if(4==t.readyState&&200==t.status&&t.responseText){var e=JSON.parse(t.responseText).token;window.localStorage.setItem("token",e),app.openSocket(e)}},t.send(JSON.stringify(e))},renewToken:function(){var e={token:window.localStorage.getItem("token")};if(e.token){var t=new XMLHttpRequest;t.open("POST",app.refresh_endpoint,!0),t.setRequestHeader("Content-type","application/json;charset=UTF-8"),t.onload=function(){if(4==t.readyState&&200==t.status&&t.responseText){var e=JSON.parse(t.responseText).token;window.localStorage.setItem("token",e),app.openSocket(e)}},t.send(JSON.stringify(e))}},openSocket:function(e){var t=new WebSocket(app.ws_endpoint,[e]);t.onopen=function(){app.toggleLoginView(),app.initAnimation()},t.onmessage=function(e){var t=JSON.parse(e.data);app.queue.length||app.showCommit(),app.queue.push(t.message)}},setBackgroundColor:function(){document.body.style.backgroundColor="#cd2327"},setClickListeners:function(){var e;document.body.addEventListener("mousedown",function(t){0===t.button&&(e=window.setTimeout(function(){app.toggleLoginView()},500)),"none"!==document.getElementById("login-view").style.display&&(document.getElementById("login-view").contains(t.target)||(app.toggleLoginView(),window.clearTimeout(e)))}),document.body.addEventListener("mouseup",function(){window.clearTimeout(e)}),document.body.addEventListener("keyup",function(e){27===e.keyCode&&app.toggleLoginView()}),document.getElementById("login-btn").addEventListener("click",function(e){e.preventDefault();var t={};return t.username=document.getElementById("login-input-username").value,t.password=document.getElementById("login-input-password").value,app.fetchToken(t),!1})},setTouchListeners:function(){var e;document.body.addEventListener("touchstart",function(t){e=window.setTimeout(function(){app.toggleLoginView()},500)}),document.body.addEventListener("touchend",function(){window.clearTimeout(e)})},toggleLoginView:function(){"none"===document.getElementById("login-view").style.display?document.getElementById("login-view").style.display="flex":document.getElementById("login-view").style.display="none"},addCommit:function(e){var t=document.createElement("span");document.body.appendChild(t);var n=Math.floor(Math.random()*app.commit_animation_duration)+3;t.className="animation",t.style.cssText="right:"+n+"vw; animation-duration:"+app.commit_animation_duration+"s; font-size:"+app.commit_font_size+"px;",t.innerHTML=e,window.setTimeout(function(e){e.parentNode.removeChild(e)},1e3*app.commit_animation_duration,t),app.showCommit()},showCommit:function(){window.setTimeout(function(){app.queue.length&&app.addCommit(app.queue.shift())},1e3)},initAnimation:function(){window.setInterval(function(){for(var e=0;e<Math.floor(5*Math.random());e++){var t=document.createElement("span");document.body.appendChild(t);var n=app.chars[Math.floor(Math.random()*app.chars.length)],o=Math.floor(15*Math.random()),a=Math.floor(Math.random()*(45-3*o))+3,i=12+(15-o);t.className="animation",t.style.cssText="right:"+a+"vw; font-size: "+i+"px; animation-duration:"+o+"s",t.innerHTML=n,window.setTimeout(function(e){e.parentNode.removeChild(e)},1e3*o,t)}},250)}};document.addEventListener("DOMContentLoaded",app.init);